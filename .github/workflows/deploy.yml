name: Deploy to test servers


on:
  workflow_dispatch:
    inputs:
      HELIOS_TRIGGERED_BY:
        description: "Username that triggered deployment"
        required: true
        type: string
      HELIOS_BRANCH_NAME:
        description: "Which branch to deploy"
        required: true
        type: string
      HELIOS_BRANCH_HEAD_SHA:
        description: "SHA of the branch to deploy"
        required: true
        type: string
      HELIOS_ENVIRONMENT_NAME:
        description: "Which environment to deploy (e.g. artemis-test7.artemis.cit.tum.de, etc.)."
        required: true
        type: string
      HELIOS_RAW_URL:
        description: "URL to the raw content of the repository in the format https://raw.githubusercontent.com/:owner/:repo/:sha"
        required: true
        type: string
      HELIOS_BUILD:
        description: "Whether to also build or just deploy the existing Docker image"
        required: true
        type: boolean
      HELIOS_PR_NUMBER:
        description: "PR number that triggered deployment"
        required: false
        type: string
      HELIOS_BUILD_TAG:
        description: "Docker tag to use if we are building or pulling an existing image"
        required: false
        type: string

jobs:
  conditional_build_job:
    runs-on: ubuntu-latest
    steps:
    - name: Send greeting
      run: echo "Hello"  
    - name: Set Failure Details
      if: failure()
      run: echo "failure_reason=Build failed at Step 1" >> $GITHUB_ENV
    - name: Force failure for testing
      if: ${{ always() }}  # Runs even if previous steps failed
      run: |
        echo "‚ùå Intentionally failing conditional build job"
        exit 1  # Non-zero exit code fails the step
  deploy:
    environment: ${{ github.event.inputs.HELIOS_ENVIRONMENT_NAME }}
    needs: conditional_build_job
    runs-on: ubuntu-latest
    steps:
    - name: Send greeting
      run: echo "Hello"
    - name: Sleep for 15 seconds  # Added sleep step
      run: sleep 15s  
